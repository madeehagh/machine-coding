name: "CodeQL"

on:
  workflow_dispatch

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest

    steps:
      - name: Set GITHUB_RUN_ATTEMPT
        run: |
          echo "GITHUB_RUN_ATTEMPT=1" >> $GITHUB_ENV

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: java-kotlin
          token: ${{ secrets.WORKFLOW_TOKEN }}

      - run: |
          echo "Run, Build Application using script"
          mvn clean package -f pom.xml -e -X -B -V -Dfindbugs.skip -Dcheckstyle.skip -Dpmd.skip=true -Dspotbugs.skip -Denforcer.skip -Dmaven.javadoc.skip -DskipTests -Dmaven.test.skip.exec -Dlicense.skip=true -Drat.skip=true -Dspotless.check.skip=true

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
        with:
          category: "/language:java-kotlin"
          token: ${{ secrets.WORKFLOW_TOKEN }}
   